plugins {
    id 'java'
    id 'application'
    id 'org.jetbrains.kotlin.jvm' version '1.6.0'
}
mainClassName='shandiankulishe.kleebot.KleeBot'
repositories {
    maven { url 'https://maven.aliyun.com/repository/public' }
    mavenCentral()
}

jar{
    manifest{
        attributes 'Main-Class': 'shandiankulishe.kleebot.KleeBot'
        exclude 'META-INF/*.RSA', 'META-INF/*.SF','META-INF/*.DSA'
    }
    from {
        configurations.runtimeClasspath.collect {
            it.isDirectory() ? it : zipTree(it)
        }
    }
}
task makeFullJar(type: Jar){
}
task makeReleaseJar(type: Jar){
    manifest{
        attributes 'Main-Class': 'shandiankulishe.kleebot.KleeBot'
    }
    baseName 'KleeBot'
    from 'build/classes/java/main'
    from 'src/main/resources'
    destinationDirectory=file('build/release')
}
makeReleaseJar.dependsOn(classes)
dependencies{
    implementation 'org.apache.logging.log4j:log4j-core:2.15.0'
    implementation 'org.apache.logging.log4j:log4j-api:2.15.0'
    implementation 'org.apache.commons:commons-compress:1.21'
    implementation 'net.mamoe:mirai-core:2.9.2'
    implementation 'net.mamoe:mirai-logging-log4j2:2.9.2'
    implementation 'com.google.code.gson:gson:2.8.9'
    implementation 'org.seleniumhq.selenium:selenium-java:4.1.2'
    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.7.0'
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.7.0'
}

tasks.withType(JavaCompile) {
    options.encoding = "UTF-8"
}
tasks.withType(Jar) { duplicatesStrategy = DuplicatesStrategy.INCLUDE }
task exportLibs(type:Copy){
    from configurations.runtimeClasspath
    into "build/deps/"
}
test {
    useJUnitPlatform()
}
java {
    sourceCompatibility = JavaVersion.VERSION_17
    targetCompatibility = JavaVersion.VERSION_17
}